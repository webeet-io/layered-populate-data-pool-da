name: immowelt-hourly-test

on:
  workflow_dispatch:
  push:
    branches:
      - 393-data-integration-automating-immowelt-scraper-step-2-preliminary-research-on-automation-with-github-actions
    paths:
      - '.github/workflows/immowelt-hourly-test.yml'
      - '.github/scripts/neon_append_timestamp.py'
  schedule:
    - cron: "17 * * * *"

jobs:
  append-to-neon:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install psycopg2-binary

      - name: Append timestamp to Neon (skips if no secret)
        env:
          NEON_DB_URL: ${{ secrets.NEON_DB_URL }}
          GITHUB_RUN_ID: ${{ github.run_id }}
          GITHUB_REF_NAME: ${{ github.ref_name }}
          GITHUB_SHA: ${{ github.sha }}
        run: |
          if [ -z "$NEON_DB_URL" ]; then
            echo "NEON_DB_URL is not set â€” skipping DB write (dry run)."
            exit 0
          fi
          python .github/scripts/neon_append_timestamp.py

      - name: Show UTC time
        run: date -u
